# 3.0 - Endpoints de Conciliação (Backend)

## Objetivo
- Criar a lógica de API para as ações de "Cadastrar" e "Cancelar" itens de similaridade, garantindo integridade transacional.

## Escopo / Entregáveis
- `src/controllers/conciliacaoController.js`
- `src/services/conciliacaoService.js`
- Novos endpoints: `POST /api/similaridade/conciliar/cadastrar` e `POST /api/similaridade/conciliar/cancelar`.

## Passos e subtarefas
- 3.1 Criar endpoint `/cadastrar`:
    - Verificar/Criar processo na tabela `processos`.
    - Inserir em `Publicacao`, `Andamento` e `Prazo`.
    - Marcar `similaridade_itens.status_decisao = 'cadastrado'`.
- 3.2 Criar endpoint `/cancelar`:
    - Registrar na tabela `similaridade_descartes_auditoria`.
    - Marcar `similaridade_itens.status_decisao = 'cancelado'`.
- 3.3 Garantir que todo o fluxo de cadastro ocorra dentro de uma única transação de banco.

## Dependências
- 1.0 - Evolução do Schema (SQL).

## Paralelizável?
- Sim, com a tarefa 2.0.

## Critérios de aceite
- O cadastro de uma publicação deve refletir nas 4 tabelas oficiais (`processos`, `Publicacao`, `Andamento`, `Prazo`).
- O descarte deve gerar um registro rastreável na auditoria.

## Testes
- 3.4 Testar cadastro de item com processo inexistente (deve criar processo).
- 3.5 Testar cadastro de item com processo já existente (deve usar o existente).
- 3.6 Forçar erro na inserção de `Prazo` e validar que a `Publicacao` não foi criada (Rollback).

## Notas
- Utilizar `req.user.tenant_id` para garantir isolamento de dados.
